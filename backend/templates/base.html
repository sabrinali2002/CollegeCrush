<!DOCTYPE html>
<html>
  <head>
    <title>College Crush</title>
    <link rel="stylesheet" href="../static/style.css">
  </head>
  <body>
    <header>
      <img src="https://i.imgur.com/gSjsexk.png" alt = "logo">
    </header>
    <div class = "content">
    <h2>Find Your Perfect College Crush</h2>
    <form onsubmit="return validateForm()">
      <div class="input-box" onclick="sendFocus()">
        <img src="https://i.imgur.com/66HSUrU.png" alt = "mag"/>
        <input name = "search" placeholder="In ONE WORD ONLY, enter your personality type! E.g. fun, reserved, studious, partier" id="filter-text-val">
      </div>

      <br><br>

      <div class = "q1">
        <label for="selectField">Select Your Preferred Region:</label>
        <select id="filter-text-val" name="selectField">
            <option value="">--Please choose an option--</option>
            <option value="northeast">Northeast</option>
            <option value="southeast">Southeast</option>
            <option value="midwest">Midwest</option>
            <option value="southwest">Southwest</option>
            <option value="west">West</option>    
        </select>
      </div>

      <br><br>

      <div class="q2">
        <div class = "city-con">
          <label for="textField">Enter a City</label>
          <input type="text" id="filter-text-val" name="city" placeholder="Input a city">
        </div>
        <div class= "or"><h2>OR</h2></div>
        <div class = "state-con">
          <label for="stateField">Select a State</label>
          <select id="filter-text-val" name="stateField">
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="DC">District Of Columbia</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
            </select>
        </div>
      </div>

      <br><br>

      <div class=" q3">
        <label for="size">Select Your Preferred School Size:</label>
        <select id="size">
          <option value="">--Please choose an option--</option>
          <option value="small">Small (under 5,000 students)</option>
          <option value="medium">Medium (5,000-15,000 students)</option>
          <option value="large">Large (over 15,000 students)</option>
        </select>
      </div>

      <br><br>

      <div class= "q4">
        <label for="sort_input">Sort By:</label>
        <select id="sort_input">
          <option value="">--Please choose an option--</option>
          <option value="Alphabetical">Alphabetical</option>
          <option value="Location">Location</option>
          <option value="Enrollment Size">Enrollment Size</option>
        </select> 
      </div>

      <br><br>

      <button type="submit" onclick="filterText()">Find My Matches</button>

    </form>
    <br>
    <div id="answer-box">

    </div>

    <footer>
        <p>&copy; College Crush 2023</p>
    </footer>

    <script>
        function answerBoxTemplate(title, location, enrolled, website,score) {
        return `<div><div>
                    <h2 class='episode-title'>${title}</h2>
                    <h4> Location: ${location}</h4>
                    <h4> Students enrolled: ${enrolled}</h5>  
                    <a href="${website}">Learn More!</a>    
                    <h4> Match Score: ${score}</h4>
                    <br>
    </div>
    </div>`
        }
        function answerBoxTemplate2(messages) {
        return `<div><div>
                    <h2>${messages}</h2> 
    </div>
    </div>`
        }

        function sendFocus() {
        document.getElementById('filter-text-val').focus()
        }
        function filterText() {
        document.getElementById("answer-box").innerHTML = ""
        console.log(document.getElementById("filter-text-val").value)
        fetch("/colleges?" + new URLSearchParams({
            title: document.getElementById("state").value, size: document.getElementById("size").value,
            location: document.getElementById("location-input").value, sort: document.getElementById("sort_input").value,
            vibes: document.getElementById("filter-text-val").value
        }).toString())
            .then((response) => response.json())
            .then((data) => {
            data.forEach(row => {
                let tempDiv = document.createElement("div")
                // console.log(row.title)
                if (row.title === undefined) {
                //tempDiv.innerHTML = answerBoxTemplate(row.title, row.location, row.enrolled, row.website)
                tempDiv.innerHTML = answerBoxTemplate2(row.messages)
                }
                else { tempDiv.innerHTML = answerBoxTemplate(row.title, row.location, row.enrolled, row.website, row.score) }
                document.getElementById("answer-box").appendChild(tempDiv)
            });
            });
        }
        
      function validateForm() {
        const dropdownValue = document.forms[0].selectField.value;
        const textInputValue = document.forms[0].city.value;
        const stateFieldValue = document.forms[0].stateField.value;
        const searchBarInput = document.forms[0].search.value;

        const stateRegex = /^[a-zA-Z]{2}$/;

        if (dropdownValue === "" && (textInputValue === "" && stateFieldValue === "")) {
          alert("Please input in a region OR a preferred city or state");
          return false;
        }

        if (textInputValue !== "" && stateTextValue !== "") {
          alert("Please input either a city or a state, not both");
          return false;
        }

        if (searchBarInput !== "" && searchBarInput.indexOf(' ') !== -1) {
          alert("Please input only one word for your personality aspect");
          return false;
        }

        return true;
      }
    </script>
  </body>
</div>
</html>